% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CMRSS_SRE.R
\name{com_block_conf_quant_larger}
\alias{com_block_conf_quant_larger}
\title{Simultaneous bound for confidence interval using combined rank sum statistic
on stratified randomized experiment}
\usage{
com_block_conf_quant_larger(
  Z,
  Y,
  block,
  set = "all",
  methods.list.all = NULL,
  weight.name = "asymp.opt",
  opt.method = "ILP_auto",
  comb.method = 1,
  stat.null = NULL,
  null.max = 10^4,
  tol = 0.01,
  alpha = 0.1
)
}
\arguments{
\item{Z}{An \eqn{n} dimensional treatment assignment vector.}

\item{Y}{An \eqn{n} dimensional observed outcome vector.}

\item{block}{An \eqn{n} dimensional vector specifying block of each
unit.}

\item{set}{Set of quantiles of interest. Options:
\itemize{
\item "treat": Prediction intervals for effect quantiles among treated units
\item "control": Prediction intervals for effect quantiles among control units
\item "all": Confidence intervals for all effect quantiles
}}

\item{methods.list.all}{A list of lists of lists. Corresponds to the
method for each stratum for each different stratified rank sum
statistic.}

\item{weight.name}{Weighting method to be implemented. If
"asymp.opt", asymptotically optimal scheme under a class of local
alternatives is adjusted, if "dist.free", design-free scheme is
adjusted.}

\item{opt.method}{Optimization method. Options include:
\itemize{
\item "ILP_gurobi": Integer linear programming with Gurobi solver
\item "LP_gurobi": Linear programming relaxation with Gurobi solver
\item "ILP_highs": Integer linear programming with HiGHS solver (open-source)
\item "LP_highs": Linear programming relaxation with HiGHS solver
\item "ILP" or "ILP_auto": Integer LP with auto-selected solver
\item "LP" or "LP_auto": Linear programming with auto-selected solver
}
HiGHS is recommended for users without a Gurobi license. Both solvers
produce equivalent results.}

\item{comb.method}{Integer specifying the combination method:
\itemize{
\item 1: Combine statistics across strata first, then take maximum across methods (default)
\item 2: Take maximum across methods within each stratum first, then combine across strata
}}

\item{stat.null}{An vector whose empirical distribution
approximates the randomization distribution of the combined
stratified rank sum statistic.}

\item{null.max}{A positive integer representing the number of
permutations for approximating the randomization distribution of
the rank sum statistic.}

\item{tol}{A numerical object specifying the precision of the
obtained confidence intervals. For example, if tol = 10^(-3),
then the confidence limits are precise up to 3 digits.}

\item{alpha}{A numerical object, where 1-alpha indicates the
confidence level.}
}
\value{
A vector specifying lower limits of prediction (confidence) intervals for
quantiles k = 1 ~ m (or n - m, or n).
}
\description{
Computes simultaneous confidence intervals for quantiles of individual
treatment effects in stratified randomized experiments.
}
\examples{
\dontrun{
# Load the electric teachers dataset
data(electric_teachers)

# Set up treatment, outcome, and blocking variable
Z <- electric_teachers$TxAny
Y <- electric_teachers$gain
block <- factor(electric_teachers$Site)
s <- length(levels(block))  # number of strata (7 sites)

# Define polynomial rank statistics with different r values
# For SRE, methods must be specified for EACH stratum within EACH statistic
r.vec <- c(2, 6, 10)
methods.list.all <- list()
for (j in seq_along(r.vec)) {
  methods.list.all[[j]] <- lapply(1:s, function(i) {
    list(name = "Polynomial", r = r.vec[j], std = TRUE, scale = FALSE)
  })
}

# Prediction intervals for effect quantiles among treated units
# Uses asymptotically optimal weighting across strata
ci.treat <- com_block_conf_quant_larger(Z, Y, block,
                                        set = "treat",
                                        methods.list.all = methods.list.all,
                                        weight.name = "asymp.opt",
                                        opt.method = "ILP",
                                        null.max = 10000,
                                        tol = 0.01,
                                        alpha = 0.05)

# Prediction intervals for control units
ci.control <- com_block_conf_quant_larger(Z, Y, block,
                                          set = "control",
                                          methods.list.all = methods.list.all,
                                          opt.method = "ILP",
                                          alpha = 0.05)

# Confidence intervals for all effect quantiles
ci.all <- com_block_conf_quant_larger(Z, Y, block,
                                      set = "all",
                                      methods.list.all = methods.list.all,
                                      opt.method = "ILP",
                                      alpha = 0.10)

# Using stratum-level combination (comb.method = 2)
# Takes maximum across methods within each stratum first
ci.treat.m2 <- com_block_conf_quant_larger(Z, Y, block,
                                           set = "treat",
                                           methods.list.all = methods.list.all,
                                           opt.method = "ILP",
                                           comb.method = 2,
                                           alpha = 0.05)

# Using LP relaxation for faster computation
ci.treat.lp <- com_block_conf_quant_larger(Z, Y, block,
                                           set = "treat",
                                           methods.list.all = methods.list.all,
                                           opt.method = "LP",
                                           alpha = 0.05)
}

}
\seealso{
\code{\link{com_conf_quant_larger_cre}} for completely randomized experiments,
\code{\link{pval_comb_block}} for hypothesis testing
}
