<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • CMRSS</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">CMRSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bowers-illinois-edu/CMRSS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/bowers-illinois-edu/CMRSS/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="package-overview">Package Overview<a class="anchor" aria-label="anchor" href="#package-overview"></a></h2>
<p>CMRSS (Combining Multiple Rank Sum Statistics) is an R package for randomization inference about quantiles of individual treatment effects. It implements methods from Kim and Li (2024) for combining multiple rank sum statistics to improve power when testing hypotheses about treatment effect quantiles.</p>
<p>The package supports: - <strong>Completely Randomized Experiments (CRE)</strong>: Functions prefixed with <code>_cre</code> - <strong>Stratified Randomized Experiments (SRE)</strong>: Functions prefixed with <code>_block</code></p>
</div>
<div class="section level2">
<h2 id="build-and-test-commands">Build and Test Commands<a class="anchor" aria-label="anchor" href="#build-and-test-commands"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Run all tests</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">R</span> CMD check .</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Run tests with testthat (faster iteration)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Run a specific test file</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-solvers.R')"</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Load package for development (uses devtools)</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="ex">Rscript</span> load.R</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Generate documentation</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"roxygen2::roxygenize()"</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># Install from local source</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL .</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="core-module-structure">Core Module Structure<a class="anchor" aria-label="anchor" href="#core-module-structure"></a></h3>
<pre><code>R/
├── CMRSS_CRE.R      # Completely randomized experiments
├── CMRSS_SRE.R      # Stratified randomized experiments (main file)
├── solvers.R        # Optimization solver abstraction (HiGHS/Gurobi)
├── comparison_methods.R  # Benchmark methods from literature (RIQITE wrappers)
├── data.R           # Dataset documentation (electric_teachers)
└── CMRSS-package.R  # Package-level documentation</code></pre>
</div>
<div class="section level3">
<h3 id="key-functions">Key Functions<a class="anchor" aria-label="anchor" href="#key-functions"></a></h3>
<p><strong>CRE (Completely Randomized Experiments)</strong>: - <code><a href="reference/comb_p_val_cre.html">comb_p_val_cre()</a></code> - Combined p-value from multiple rank statistics - <code><a href="reference/com_conf_quant_larger_cre.html">com_conf_quant_larger_cre()</a></code> - Confidence intervals for effect quantiles</p>
<p><strong>SRE (Stratified Randomized Experiments)</strong>: - <code><a href="reference/pval_comb_block.html">pval_comb_block()</a></code> - Combined p-value with stratification - <code><a href="reference/com_block_conf_quant_larger.html">com_block_conf_quant_larger()</a></code> - Confidence intervals with stratification</p>
<p><strong>Solver Functions (R/solvers.R)</strong>: - <code><a href="reference/solve_optimization.html">solve_optimization()</a></code> - Unified solver interface (auto-selects HiGHS or Gurobi) - <code><a href="reference/solver_available.html">solver_available()</a></code> - Check if a solver is installed - <code><a href="reference/parse_opt_method.html">parse_opt_method()</a></code> - Parse optimization method strings like “ILP_highs”</p>
</div>
<div class="section level3">
<h3 id="optimization-solvers">Optimization Solvers<a class="anchor" aria-label="anchor" href="#optimization-solvers"></a></h3>
<p>The package requires an optimization solver for SRE methods: - <strong>HiGHS</strong> (recommended, open-source): <code>install.packages("highs")</code> - <strong>Gurobi</strong> (commercial, requires license)</p>
<p>The <code>opt.method</code> parameter controls solver selection: - <code>"ILP_highs"</code> / <code>"LP_highs"</code> - Use HiGHS - <code>"ILP_gurobi"</code> / <code>"LP_gurobi"</code> - Use Gurobi - <code>"ILP"</code> / <code>"LP"</code> or <code>"ILP_auto"</code> / <code>"LP_auto"</code> - Auto-select</p>
</div>
<div class="section level3">
<h3 id="rank-score-methods">Rank Score Methods<a class="anchor" aria-label="anchor" href="#rank-score-methods"></a></h3>
<p>Methods are specified as lists with a <code>name</code> field: - <code>list(name = "Wilcoxon", scale = FALSE)</code> - Standard Wilcoxon scores - <code>list(name = "Stephenson", s = 3, scale = FALSE)</code> - Stephenson scores with parameter s - <code>list(name = "Polynomial", r = 2, std = TRUE, scale = FALSE)</code> - Polynomial scores</p>
<p>For SRE, methods must be specified per stratum in a nested list structure:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># H statistics, each with B block-specific methods</span></span>
<span><span class="va">methods.list.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">B</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Polynomial"</span>, r <span class="op">=</span> <span class="fl">2</span>, std <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">B</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Polynomial"</span>, r <span class="op">=</span> <span class="fl">6</span>, std <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h3>
<ul><li>Required: stats, utils, Matrix, RIQITE (from GitHub: li-xinran/RIQITE), extraDistr</li>
<li>Suggested: testthat, highs, gurobi, randomizr, RItools</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="testing-patterns">Testing Patterns<a class="anchor" aria-label="anchor" href="#testing-patterns"></a></h2>
<p>Tests use testthat edition 3. Test files cover: - <code>test-solvers.R</code> - Solver availability and equivalence - <code>test-CMRSS_CRE.R</code> / <code>test-CMRSS_SRE.R</code> - Main function tests - <code>test-rank_score.R</code> - Rank score computation - <code>test-comparison_methods.R</code> - Benchmark method wrappers</p>
<p>Example test pattern:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"description"</span>, <span class="op">{</span></span>
<span>  <span class="fu">skip_if_not</span><span class="op">(</span><span class="fu"><a href="reference/solver_available.html">solver_available</a></span><span class="op">(</span><span class="st">"highs"</span><span class="op">)</span>, <span class="st">"HiGHS not available"</span><span class="op">)</span></span>
<span>  <span class="co"># test code</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a></h2>
<p>The package includes <code>electric_teachers</code> dataset - a stratified randomized experiment from Heller et al. (2010) with 233 teachers across 7 sites.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Kim, Xinran Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

